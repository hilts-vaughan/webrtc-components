var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") return Reflect.decorate(decorators, target, key, desc);
    switch (arguments.length) {
        case 2: return decorators.reduceRight(function(o, d) { return (d && d(o)) || o; }, target);
        case 3: return decorators.reduceRight(function(o, d) { return (d && d(target, key)), void 0; }, void 0);
        case 4: return decorators.reduceRight(function(o, d) { return (d && d(target, key, o)) || o; }, desc);
    }
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var angular2_1 = require('angular2/angular2');
var StreamController_1 = require('../../services/rtc_api/StreamController');
var ControllerConfiguration_1 = require('../../services/rtc_api/ControllerConfiguration');
var RoomOptions_1 = require('../../services/rtc_api/RoomOptions');
var StreamFactory_1 = require('../../services/rtc_api/StreamFactory');
var HomeCmp = (function () {
    function HomeCmp(ref) {
        this.ref = ref;
        this.chatBuffer = [];
        this.availableRooms = [];
        this.localStreams = [];
        this.state = 0;
        this._streamController = new StreamController_1.StreamController(new ControllerConfiguration_1.ControllerConfiguration("http://hopper.wlu.ca:1239/", "WLU-HOPPER"));
        this.refreshRooms();
    }
    HomeCmp.prototype.askWebcam = function () {
        var self = this;
        StreamFactory_1.StreamFactory.createWebcamStream(true, true, function (stream) {
            if (stream != null) {
                self.localStreams.push(URL.createObjectURL(stream));
                self.activeStream = stream;
                self.moveToChoice();
            }
        });
    };
    HomeCmp.prototype.askScreen = function () {
        var self = this;
        StreamFactory_1.StreamFactory.createScreenStream(function (stream) {
            if (stream != null) {
                self.localStreams.push(URL.createObjectURL(stream));
                self.activeStream = stream;
                self.moveToChoice();
            }
        });
    };
    HomeCmp.prototype.moveToChoice = function () {
        this.state = 1;
        this.ref.detectChanges();
    };
    HomeCmp.prototype.refreshRooms = function () {
        var _this = this;
        var self = this;
        this._streamController.getRoomService().findRooms("", function (roomsFound) {
            self.availableRooms = roomsFound;
            _this.ref.detectChanges();
        });
    };
    HomeCmp.prototype.createRoom = function () {
        var _this = this;
        var roomName = prompt("Name of the room to create; ");
        var options = new RoomOptions_1.RoomOptions(roomName, false);
        this._streamController.getRoomService().createRoom(options, function (success) {
            if (success) {
                alert("Room created!");
            }
            else {
                alert("Failed to create room. Duplicate?");
            }
            _this.refreshRooms();
        });
    };
    HomeCmp.prototype.joinRoom = function () {
        var _this = this;
        var roomName = prompt("Name of the room to join?");
        var options = new RoomOptions_1.RoomOptions(roomName, false);
        var self = this;
        this._streamController.getRoomService().joinRoom(options, [self.activeStream], function (success, roomContext) {
            if (success) {
                self.activeRoom = roomContext;
                self.state = 2;
                self.ref.detectChanges();
                self.moveToPeers();
                setTimeout(_this.beginPlayback.bind(_this), 500);
            }
            else {
                alert("Failed to join room!");
            }
        });
    };
    HomeCmp.prototype.moveToPeers = function () {
        this.activeRoom.on('newstream', this.setupRemoteStream.bind(this));
    };
    HomeCmp.prototype.setupRemoteStream = function (event) {
        this.localStreams.push(URL.createObjectURL(event.stream));
        this.ref.detectChanges();
        setTimeout(this.beginPlayback.bind(this), 500);
    };
    HomeCmp.prototype.beginPlayback = function () {
        var nodes = document.getElementsByTagName('video');
        for (var i = 0; i < nodes.length; i++) {
            nodes[i].play();
        }
    };
    HomeCmp = __decorate([
        angular2_1.Component({
            selector: 'home',
            template: "\n    <div id=\"start-state\">\n\n      <div *ng-if=\"state < 2\" class=\"centered\">\n        <h1 style=\"text-align: center;\">What would you like to do?</h1>\n\n        <div *ng-if=\"state == 1\" class=\"button-wrapper\">\n          <a (click)=\"joinRoom($event)\" class=\"btn\">Join Room</a>\n          <a (click)=\"createRoom($event)\" class=\"btn\">Create Room</a>\n          <a (click)=\"refreshRooms()\" class=\"btn\">Refresh Rooms</a>\n        </div>\n\n        <div *ng-if=\"state == 0\" class=\"stream-wrapper\">\n          <a (click)=\"askWebcam()\" class=\"btn\">Share Video & Audio</a>\n          <a (click)=\"askScreen()\" class=\"btn\">Share Screen</a>\n        </div>\n\n      </div>\n\n      <!--Video displays here-->\n      <div *ng-if=\"state == 2\">\n        <div *ng-for=\"#stream of localStreams\">\n          <video class=\"video-display\" src=\"{{stream}}\" autoplay=\"true\"></video>\n        </div>\n      </div>\n\n      <div *ng-if=\"state < 2\" class=\"room-list\">\n        <h2>Available Rooms</h1>\n        <div class=\"name-container\">\n          <div *ng-for=\"#room of availableRooms\" class=\"room-name\">{{room.roomName}}</div> \n        </div>\n     </div>  \n \n    </div>\n\n\n    <div id=\"chat-view\">\n      <div class=\"col-md-12\">\n        <div class=\"row\">\n          <div id=\"chat-sidebar\" class=\"col-sm-2\">\n            <ul>\n              <li *ng-for=\"#name of roomNames\">{{name}}</li>\n            </ul>\n            <form>\n            <input id=\"message-box\">\n            </form>\n            <button (click)=\"sendMessage($event)\">Send Message</button>        \n            <button (click)=\"createRoom($event)\">Create Room</button>\n            <button (click)=\"joinRoom($event)\">Join Room</button>\n        \n            <!--Message area-->\n            <div class=\"row\" *ng-for=\"#chatMessage of chatBuffer\">\n              <b>{{chatMessage}}</b>\n              </br> \n            </div>\n        \n          </div>\n          <div id=\"chat-main\" class=\"col-sm-10\">\n            <!--Video displays here-->\n            <div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    </div>\n  ",
            styles: ["\n    #start-state {\n    \tposition: absolute;\n    \theight: 100%;\n    \twidth: 100%;\n    \ttop: 0;\n    \tleft: 0;\n    \tbackground-color: black;\n    \tz-index: 500;\n    }\n\n    #start-state .centered {\n     \tposition: absolute;\n        top: 50%;\n        left: 50%;\n        width: 600px;\n        height: 300px;\n        margin-top: -150px;\n        margin-left: -300px;\n    }\n\n    #start-state .room-list {\n      position: absolute;\n      top: 0;\n      left: 0;\n      height: 100%;\n      width: 170px;\n      background-color: rgba(221, 160, 221, 0.05);\n    }\n\n    #start-state h2 {\n      font-size: 16px;\n      text-align: center;\n    }\n\n    #start-state .room-name {\n      font-weight: bold;\n      text-align: left;\n      padding-left: 4px;\n      margin-top: 5px;\n      font-size: 14px;\n      text-overflow: ellipsis;\n      color: white;\n    }\n\n    #start-state input {\n    \tborder-radius: 3px;\n    \tfont-size: 16px;\n    }\n\n    #start-state video {\n      width: 480px;\n      float: left;\n    }\n\n    .btn {\n      padding-top: 35px;\n      margin-top: 5px;\n      text-align: center;\n      display: block;\n    }\n\n    .btn {\n      background: #3498db;\n      background-image: -webkit-linear-gradient(top, #3498db, #2980b9);\n      background-image: -moz-linear-gradient(top, #3498db, #2980b9);\n      background-image: -ms-linear-gradient(top, #3498db, #2980b9);\n      background-image: -o-linear-gradient(top, #3498db, #2980b9);\n      background-image: linear-gradient(to bottom, #3498db, #2980b9);\n      -webkit-border-radius: 28;\n      -moz-border-radius: 28;\n      border-radius: 28px;\n      font-family: Arial;\n      color: #ffffff;\n      font-size: 14px;\n      padding: 10px 20px 10px 20px;\n      text-decoration: none;\n    }\n\n    .btn:hover {\n      background: #3cb0fd;\n      background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);\n      background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);\n      background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);\n      background-image: -o-linear-gradient(top, #3cb0fd, #3498db);\n      background-image: linear-gradient(to bottom, #3cb0fd, #3498db);\n      text-decoration: none;\n    }\n  "],
            directives: [angular2_1.CORE_DIRECTIVES]
        }), 
        __metadata('design:paramtypes', [angular2_1.ChangeDetectorRef])
    ], HomeCmp);
    return HomeCmp;
})();
exports.HomeCmp = HomeCmp;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvaG9tZS9ob21lLnRzIl0sIm5hbWVzIjpbIkhvbWVDbXAiLCJIb21lQ21wLmNvbnN0cnVjdG9yIiwiSG9tZUNtcC5hc2tXZWJjYW0iLCJIb21lQ21wLmFza1NjcmVlbiIsIkhvbWVDbXAubW92ZVRvQ2hvaWNlIiwiSG9tZUNtcC5yZWZyZXNoUm9vbXMiLCJIb21lQ21wLmNyZWF0ZVJvb20iLCJIb21lQ21wLmpvaW5Sb29tIiwiSG9tZUNtcC5tb3ZlVG9QZWVycyIsIkhvbWVDbXAuc2V0dXBSZW1vdGVTdHJlYW0iLCJIb21lQ21wLmJlZ2luUGxheWJhY2siXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEseUJBQXFGLG1CQUFtQixDQUFDLENBQUE7QUFHekcsaUNBQStCLHlDQUMvQixDQUFDLENBRHVFO0FBQ3hFLHdDQUFzQyxnREFDdEMsQ0FBQyxDQURxRjtBQUN0Riw0QkFBMEIsb0NBQzFCLENBQUMsQ0FENkQ7QUFDOUQsOEJBQTRCLHNDQUM1QixDQUFDLENBRGlFO0FBR2xFO0lBaUxFQSxpQkFBbUJBLEdBQXNCQTtRQUF0QkMsUUFBR0EsR0FBSEEsR0FBR0EsQ0FBbUJBO1FBZmpDQSxlQUFVQSxHQUFrQkEsRUFBRUEsQ0FBQ0E7UUFDL0JBLG1CQUFjQSxHQUF1QkEsRUFBRUEsQ0FBQ0E7UUFDeENBLGlCQUFZQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUtsQkEsVUFBS0EsR0FBV0EsQ0FBQ0EsQ0FBQ0E7UUFNbEJBLHNCQUFpQkEsR0FBcUJBLElBQUlBLG1DQUFnQkEsQ0FBQ0EsSUFBSUEsaURBQXVCQSxDQUFDQSw0QkFBNEJBLEVBQUVBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO1FBSTFJQSxJQUFJQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQTtJQUN0QkEsQ0FBQ0E7SUFLT0QsMkJBQVNBLEdBQWpCQTtRQUNFRSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUNoQkEsNkJBQWFBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFB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QSxDQUFDQSxhQUFhQSxFQUFFQSxDQUFDQTtRQUN6QkEsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDakRBLENBQUNBO0lBTU9ULCtCQUFhQSxHQUFyQkE7UUFDRVUsSUFBSUEsS0FBS0EsR0FBR0EsUUFBUUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUNuREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDdENBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBQ2xCQSxDQUFDQTtJQUNIQSxDQUFDQTtJQWhTSFY7UUFBQ0Esb0JBQVNBLENBQUNBO1lBQ1RBLFFBQVFBLEVBQUVBLE1BQU1BO1lBQ2hCQSxRQUFRQSxFQUFFQSw0cEVBa0VUQTtZQUNEQSxNQUFNQSxFQUFFQSxDQUFDQSxtc0VBd0ZSQSxDQUFDQTtZQUNGQSxVQUFVQSxFQUFFQSxDQUFDQSwwQkFBZUEsQ0FBQ0E7U0FDOUJBLENBQUNBOztnQkFxSURBO0lBQURBLGNBQUNBO0FBQURBLENBcFNBLEFBb1NDQSxJQUFBO0FBcElZLGVBQU8sVUFvSW5CLENBQUEiLCJmaWxlIjoiY29tcG9uZW50cy9ob21lL2hvbWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgQ09SRV9ESVJFQ1RJVkVTLCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWZ9IGZyb20gJ2FuZ3VsYXIyL2FuZ3VsYXIyJztcblxuLy8gV2ViUlRDIGNvcmUgZGlyZWN0aXZlc1xuaW1wb3J0IHtTdHJlYW1Db250cm9sbGVyfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9ydGNfYXBpL1N0cmVhbUNvbnRyb2xsZXInXG5pbXBvcnQge0NvbnRyb2xsZXJDb25maWd1cmF0aW9ufSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9ydGNfYXBpL0NvbnRyb2xsZXJDb25maWd1cmF0aW9uJ1xuaW1wb3J0IHtSb29tT3B0aW9uc30gZnJvbSAnLi4vLi4vc2VydmljZXMvcnRjX2FwaS9Sb29tT3B0aW9ucydcbmltcG9ydCB7U3RyZWFtRmFjdG9yeX0gZnJvbSAnLi4vLi4vc2VydmljZXMvcnRjX2FwaS9TdHJlYW1GYWN0b3J5J1xuaW1wb3J0IHtTdHJlYW1Sb29tfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9ydGNfYXBpL1N0cmVhbVJvb20nXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2hvbWUnLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgaWQ9XCJzdGFydC1zdGF0ZVwiPlxuXG4gICAgICA8ZGl2ICpuZy1pZj1cInN0YXRlIDwgMlwiIGNsYXNzPVwiY2VudGVyZWRcIj5cbiAgICAgICAgPGgxIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyO1wiPldoYXQgd291bGQgeW91IGxpa2UgdG8gZG8/PC9oMT5cblxuICAgICAgICA8ZGl2ICpuZy1pZj1cInN0YXRlID09IDFcIiBjbGFzcz1cImJ1dHRvbi13cmFwcGVyXCI+XG4gICAgICAgICAgPGEgKGNsaWNrKT1cImpvaW5Sb29tKCRldmVudClcIiBjbGFzcz1cImJ0blwiPkpvaW4gUm9vbTwvYT5cbiAgICAgICAgICA8YSAoY2xpY2spPVwiY3JlYXRlUm9vbSgkZXZlbnQpXCIgY2xhc3M9XCJidG5cIj5DcmVhdGUgUm9vbTwvYT5cbiAgICAgICAgICA8YSAoY2xpY2spPVwicmVmcmVzaFJvb21zKClcIiBjbGFzcz1cImJ0blwiPlJlZnJlc2ggUm9vbXM8L2E+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgKm5nLWlmPVwic3RhdGUgPT0gMFwiIGNsYXNzPVwic3RyZWFtLXdyYXBwZXJcIj5cbiAgICAgICAgICA8YSAoY2xpY2spPVwiYXNrV2ViY2FtKClcIiBjbGFzcz1cImJ0blwiPlNoYXJlIFZpZGVvICYgQXVkaW88L2E+XG4gICAgICAgICAgPGEgKGNsaWNrKT1cImFza1NjcmVlbigpXCIgY2xhc3M9XCJidG5cIj5TaGFyZSBTY3JlZW48L2E+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICA8L2Rpdj5cblxuICAgICAgPCEtLVZpZGVvIGRpc3BsYXlzIGhlcmUtLT5cbiAgICAgIDxkaXYgKm5nLWlmPVwic3RhdGUgPT0gMlwiPlxuICAgICAgICA8ZGl2ICpuZy1mb3I9XCIjc3RyZWFtIG9mIGxvY2FsU3RyZWFtc1wiPlxuICAgICAgICAgIDx2aWRlbyBjbGFzcz1cInZpZGVvLWRpc3BsYXlcIiBzcmM9XCJ7e3N0cmVhbX19XCIgYXV0b3BsYXk9XCJ0cnVlXCI+PC92aWRlbz5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiAqbmctaWY9XCJzdGF0ZSA8IDJcIiBjbGFzcz1cInJvb20tbGlzdFwiPlxuICAgICAgICA8aDI+QXZhaWxhYmxlIFJvb21zPC9oMT5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm5hbWUtY29udGFpbmVyXCI+XG4gICAgICAgICAgPGRpdiAqbmctZm9yPVwiI3Jvb20gb2YgYXZhaWxhYmxlUm9vbXNcIiBjbGFzcz1cInJvb20tbmFtZVwiPnt7cm9vbS5yb29tTmFtZX19PC9kaXY+IFxuICAgICAgICA8L2Rpdj5cbiAgICAgPC9kaXY+ICBcbiBcbiAgICA8L2Rpdj5cblxuXG4gICAgPGRpdiBpZD1cImNoYXQtdmlld1wiPlxuICAgICAgPGRpdiBjbGFzcz1cImNvbC1tZC0xMlwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgPGRpdiBpZD1cImNoYXQtc2lkZWJhclwiIGNsYXNzPVwiY29sLXNtLTJcIj5cbiAgICAgICAgICAgIDx1bD5cbiAgICAgICAgICAgICAgPGxpICpuZy1mb3I9XCIjbmFtZSBvZiByb29tTmFtZXNcIj57e25hbWV9fTwvbGk+XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgPGZvcm0+XG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJtZXNzYWdlLWJveFwiPlxuICAgICAgICAgICAgPC9mb3JtPlxuICAgICAgICAgICAgPGJ1dHRvbiAoY2xpY2spPVwic2VuZE1lc3NhZ2UoJGV2ZW50KVwiPlNlbmQgTWVzc2FnZTwvYnV0dG9uPiAgICAgICAgXG4gICAgICAgICAgICA8YnV0dG9uIChjbGljayk9XCJjcmVhdGVSb29tKCRldmVudClcIj5DcmVhdGUgUm9vbTwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiAoY2xpY2spPVwiam9pblJvb20oJGV2ZW50KVwiPkpvaW4gUm9vbTwvYnV0dG9uPlxuICAgICAgICBcbiAgICAgICAgICAgIDwhLS1NZXNzYWdlIGFyZWEtLT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIiAqbmctZm9yPVwiI2NoYXRNZXNzYWdlIG9mIGNoYXRCdWZmZXJcIj5cbiAgICAgICAgICAgICAgPGI+e3tjaGF0TWVzc2FnZX19PC9iPlxuICAgICAgICAgICAgICA8L2JyPiBcbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBcbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGlkPVwiY2hhdC1tYWluXCIgY2xhc3M9XCJjb2wtc20tMTBcIj5cbiAgICAgICAgICAgIDwhLS1WaWRlbyBkaXNwbGF5cyBoZXJlLS0+XG4gICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIGAsXG4gIHN0eWxlczogW2BcbiAgICAjc3RhcnQtc3RhdGUge1xuICAgIFx0cG9zaXRpb246IGFic29sdXRlO1xuICAgIFx0aGVpZ2h0OiAxMDAlO1xuICAgIFx0d2lkdGg6IDEwMCU7XG4gICAgXHR0b3A6IDA7XG4gICAgXHRsZWZ0OiAwO1xuICAgIFx0YmFja2dyb3VuZC1jb2xvcjogYmxhY2s7XG4gICAgXHR6LWluZGV4OiA1MDA7XG4gICAgfVxuXG4gICAgI3N0YXJ0LXN0YXRlIC5jZW50ZXJlZCB7XG4gICAgIFx0cG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICB0b3A6IDUwJTtcbiAgICAgICAgbGVmdDogNTAlO1xuICAgICAgICB3aWR0aDogNjAwcHg7XG4gICAgICAgIGhlaWdodDogMzAwcHg7XG4gICAgICAgIG1hcmdpbi10b3A6IC0xNTBweDtcbiAgICAgICAgbWFyZ2luLWxlZnQ6IC0zMDBweDtcbiAgICB9XG5cbiAgICAjc3RhcnQtc3RhdGUgLnJvb20tbGlzdCB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICB0b3A6IDA7XG4gICAgICBsZWZ0OiAwO1xuICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgd2lkdGg6IDE3MHB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyMjEsIDE2MCwgMjIxLCAwLjA1KTtcbiAgICB9XG5cbiAgICAjc3RhcnQtc3RhdGUgaDIge1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIH1cblxuICAgICNzdGFydC1zdGF0ZSAucm9vbS1uYW1lIHtcbiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgICAgdGV4dC1hbGlnbjogbGVmdDtcbiAgICAgIHBhZGRpbmctbGVmdDogNHB4O1xuICAgICAgbWFyZ2luLXRvcDogNXB4O1xuICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gICAgICBjb2xvcjogd2hpdGU7XG4gICAgfVxuXG4gICAgI3N0YXJ0LXN0YXRlIGlucHV0IHtcbiAgICBcdGJvcmRlci1yYWRpdXM6IDNweDtcbiAgICBcdGZvbnQtc2l6ZTogMTZweDtcbiAgICB9XG5cbiAgICAjc3RhcnQtc3RhdGUgdmlkZW8ge1xuICAgICAgd2lkdGg6IDQ4MHB4O1xuICAgICAgZmxvYXQ6IGxlZnQ7XG4gICAgfVxuXG4gICAgLmJ0biB7XG4gICAgICBwYWRkaW5nLXRvcDogMzVweDtcbiAgICAgIG1hcmdpbi10b3A6IDVweDtcbiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIH1cblxuICAgIC5idG4ge1xuICAgICAgYmFja2dyb3VuZDogIzM0OThkYjtcbiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgIzM0OThkYiwgIzI5ODBiOSk7XG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudCh0b3AsICMzNDk4ZGIsICMyOTgwYjkpO1xuICAgICAgYmFja2dyb3VuZC1pbWFnZTogLW1zLWxpbmVhci1ncmFkaWVudCh0b3AsICMzNDk4ZGIsICMyOTgwYjkpO1xuICAgICAgYmFja2dyb3VuZC1pbWFnZTogLW8tbGluZWFyLWdyYWRpZW50KHRvcCwgIzM0OThkYiwgIzI5ODBiOSk7XG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjMzQ5OGRiLCAjMjk4MGI5KTtcbiAgICAgIC13ZWJraXQtYm9yZGVyLXJhZGl1czogMjg7XG4gICAgICAtbW96LWJvcmRlci1yYWRpdXM6IDI4O1xuICAgICAgYm9yZGVyLXJhZGl1czogMjhweDtcbiAgICAgIGZvbnQtZmFtaWx5OiBBcmlhbDtcbiAgICAgIGNvbG9yOiAjZmZmZmZmO1xuICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgcGFkZGluZzogMTBweCAyMHB4IDEwcHggMjBweDtcbiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICB9XG5cbiAgICAuYnRuOmhvdmVyIHtcbiAgICAgIGJhY2tncm91bmQ6ICMzY2IwZmQ7XG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCh0b3AsICMzY2IwZmQsICMzNDk4ZGIpO1xuICAgICAgYmFja2dyb3VuZC1pbWFnZTogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAjM2NiMGZkLCAjMzQ5OGRiKTtcbiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IC1tcy1saW5lYXItZ3JhZGllbnQodG9wLCAjM2NiMGZkLCAjMzQ5OGRiKTtcbiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICMzY2IwZmQsICMzNDk4ZGIpO1xuICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgIzNjYjBmZCwgIzM0OThkYik7XG4gICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgfVxuICBgXSxcbiAgZGlyZWN0aXZlczogW0NPUkVfRElSRUNUSVZFU11cbn0pXG5leHBvcnQgY2xhc3MgSG9tZUNtcCB7XG5cbiAgcHJpdmF0ZSBjaGF0QnVmZmVyOiBBcnJheTxTdHJpbmc+ID0gW107XG4gIHByaXZhdGUgYXZhaWxhYmxlUm9vbXM6IEFycmF5PFJvb21PcHRpb25zPiA9IFtdO1xuICBwcml2YXRlIGxvY2FsU3RyZWFtcyA9IFtdO1xuICBwcml2YXRlIGFjdGl2ZVN0cmVhbSA6IE1lZGlhU3RyZWFtO1xuICBwcml2YXRlIGFjdGl2ZVJvb206IFN0cmVhbVJvb207XG4gIFxuICAvLyBQb29yIG1hbidzIHN0YXRlIG1hY2hpbmU7IFxuICBwcml2YXRlIHN0YXRlOiBudW1iZXIgPSAwO1xuICBcblxuICBcbiAgLy8gV2UgbmVlZCBhIHN0cmVhbSBjb250cm9sbGVyIHRvIGJvb3RzdHJhcCB0aGUgcHJvY2Vzcy4gVGhlIGNvbnRleHQga2V5IGlzIGEgdW5pcXVlIHNlc3Npb24ga2V5IHRoYXQgaXNvbGF0ZXMgdGhlIHByb2Nlc3MgZnJvbSBvdGhlciB1c2Vycy5cbiAgLy8gSWYgeW91IGFyZSBqdXN0IGV4cGVyaW1lbnRpbmcsIHVzaW5nIHRoZSBkZWZhdWx0IGNvbnRleHQga2V5IGlzIGZpbmUuXG4gIHByaXZhdGUgX3N0cmVhbUNvbnRyb2xsZXI6IFN0cmVhbUNvbnRyb2xsZXIgPSBuZXcgU3RyZWFtQ29udHJvbGxlcihuZXcgQ29udHJvbGxlckNvbmZpZ3VyYXRpb24oXCJodHRwOi8vaG9wcGVyLndsdS5jYToxMjM5L1wiLCBcIldMVS1IT1BQRVJcIikpO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyByZWY6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgLy8gTk9URTogQW5ndWxhckpTIGNoYW5nZSBkZXRlY3RvcjsgYWxsb3dzIHVzIHRvIHRha2Ugb3ZlciB0aGUgVUkuIEl0J3MgaW5qZWN0ZWQgdmlhIHJlZjsgbm8gcmVsYXRlZCB0byB0aGUgV2ViUlRDXG4gICAgdGhpcy5yZWZyZXNoUm9vbXMoKTsgIC8vIGluaXRpYWwgcmVmcmVzaFxuICB9XG4gIFxuICAvKipcbiAgICogRmV0Y2ggc3RyZWFtcyB3ZSB3YW50IHRvIHVzZSBoZXJlOyBhc2sgdXNlciBhYm91dCB3aGljaCB0byB1c2VcbiAgICovXG4gIHByaXZhdGUgYXNrV2ViY2FtKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBTdHJlYW1GYWN0b3J5LmNyZWF0ZVdlYmNhbVN0cmVhbSh0cnVlLCB0cnVlLCAoc3RyZWFtOiBNZWRpYVN0cmVhbSkgPT4ge1xuICAgICAgaWYgKHN0cmVhbSAhPSBudWxsKSB7XG4gICAgICAgIHNlbGYubG9jYWxTdHJlYW1zLnB1c2goVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pKTtcbiAgICAgICAgc2VsZi5hY3RpdmVTdHJlYW0gPSBzdHJlYW07XG4gICAgICAgIHNlbGYubW92ZVRvQ2hvaWNlKCk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgYXNrU2NyZWVuKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBTdHJlYW1GYWN0b3J5LmNyZWF0ZVNjcmVlblN0cmVhbSgoc3RyZWFtOiBNZWRpYVN0cmVhbSkgPT4ge1xuICAgICAgaWYgKHN0cmVhbSAhPSBudWxsKSB7XG4gICAgICAgIHNlbGYubG9jYWxTdHJlYW1zLnB1c2goVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pKTtcbiAgICAgICAgc2VsZi5hY3RpdmVTdHJlYW0gPSBzdHJlYW07XG4gICAgICAgIHNlbGYubW92ZVRvQ2hvaWNlKCk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxuICBcbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgZm9yIG1vdmluZyBvbnRvIGpvaW4gcm9vbSAvIGNyZWF0ZSByb29tIHN0YXRlXG4gICAqL1xuICBwcml2YXRlIG1vdmVUb0Nob2ljZSgpIHtcbiAgICB0aGlzLnN0YXRlID0gMTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgXG4gIFxuICAvKipcbiAgICogU2VsZWN0aW9uIG9mIHdoYXQgdG8gZG8sIG1vdmluZyBhbG9uZyBub3dcbiAgICovXG5cbiAgcHJpdmF0ZSByZWZyZXNoUm9vbXMoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuX3N0cmVhbUNvbnRyb2xsZXIuZ2V0Um9vbVNlcnZpY2UoKS5maW5kUm9vbXMoXCJcIiwgKHJvb21zRm91bmQ6IEFycmF5PFJvb21PcHRpb25zPikgPT4ge1xuICAgICAgc2VsZi5hdmFpbGFibGVSb29tcyA9IHJvb21zRm91bmQ7XG4gICAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7IC8vIEZvcmNlIGRpc3BsYXkgdXBkYXRlICAgIFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVSb29tKCkge1xuICAgIHZhciByb29tTmFtZTogc3RyaW5nID0gcHJvbXB0KFwiTmFtZSBvZiB0aGUgcm9vbSB0byBjcmVhdGU7IFwiKTtcbiAgICB2YXIgb3B0aW9uczogUm9vbU9wdGlvbnMgPSBuZXcgUm9vbU9wdGlvbnMocm9vbU5hbWUsIGZhbHNlKTtcbiAgICB0aGlzLl9zdHJlYW1Db250cm9sbGVyLmdldFJvb21TZXJ2aWNlKCkuY3JlYXRlUm9vbShvcHRpb25zLCAoc3VjY2VzcykgPT4ge1xuICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgYWxlcnQoXCJSb29tIGNyZWF0ZWQhXCIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGFsZXJ0KFwiRmFpbGVkIHRvIGNyZWF0ZSByb29tLiBEdXBsaWNhdGU/XCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZWZyZXNoIGFueXdheTsgc2hvdyBkdXBsaWNhdGVzXG4gICAgICB0aGlzLnJlZnJlc2hSb29tcygpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBqb2luUm9vbSgpIHtcbiAgICB2YXIgcm9vbU5hbWU6IHN0cmluZyA9IHByb21wdChcIk5hbWUgb2YgdGhlIHJvb20gdG8gam9pbj9cIik7XG4gICAgdmFyIG9wdGlvbnM6IFJvb21PcHRpb25zID0gbmV3IFJvb21PcHRpb25zKHJvb21OYW1lLCBmYWxzZSk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuX3N0cmVhbUNvbnRyb2xsZXIuZ2V0Um9vbVNlcnZpY2UoKS5qb2luUm9vbShvcHRpb25zLCBbc2VsZi5hY3RpdmVTdHJlYW1dLCAoc3VjY2VzczogYm9vbGVhbiwgcm9vbUNvbnRleHQ6IFN0cmVhbVJvb20pID0+IHtcbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIHNlbGYuYWN0aXZlUm9vbSA9IHJvb21Db250ZXh0O1xuICAgICAgICBzZWxmLnN0YXRlID0gMjtcbiAgICAgICAgc2VsZi5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICBzZWxmLm1vdmVUb1BlZXJzKCk7XG4gICAgICAgIHNldFRpbWVvdXQodGhpcy5iZWdpblBsYXliYWNrLmJpbmQodGhpcyksIDUwMCk7IC8vIG1vdmUgdG8gdGhlIG5leHQgc3RhdGUgYW5kIGJlZ2luIHBsYXliYWNrIHNob3J0bHlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFsZXJ0KFwiRmFpbGVkIHRvIGpvaW4gcm9vbSFcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBXZSdyZSBpbnNpZGUgYSByb29tISBMZXQncyBkbyBzb21ldGhpbmcuLi5cbiAgICovXG5cbiAgcHJpdmF0ZSBtb3ZlVG9QZWVycygpIHtcbiAgICB0aGlzLmFjdGl2ZVJvb20ub24oJ25ld3N0cmVhbScsIHRoaXMuc2V0dXBSZW1vdGVTdHJlYW0uYmluZCh0aGlzKSk7XG4gICAgLy8gdGhpcy5hY3RpdmVSb29tLm9uKCdkYXRhJywgdGhpcy5kYXRhUmVjZWl2ZWQuYmluZCh0aGlzKSk7XG4gIH1cblxuICAvKipcbiAgICogUHVzaCB1cCBhIG5ldyByZW1vdGUgc3RyZWFtIGludG8gdGhlIGFwcGxpY2F0aW9uIHN0cmVhbS5cbiAgICovXG4gIHByaXZhdGUgc2V0dXBSZW1vdGVTdHJlYW0oZXZlbnQ6IGFueSkge1xuICAgIHRoaXMubG9jYWxTdHJlYW1zLnB1c2goVVJMLmNyZWF0ZU9iamVjdFVSTChldmVudC5zdHJlYW0pKTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7IFxuICAgIHNldFRpbWVvdXQodGhpcy5iZWdpblBsYXliYWNrLmJpbmQodGhpcyksIDUwMCk7XG4gIH1cblxuICAvKipcbiAgICogQmVnaW5zIHBsYXliYWNrIG9mIGFsbCB2aWRlbyBvbiB0aGUgc2NyZWVuLCB1c2VkIHRvIGVuc3VyZSB0aGUgYnJvd3NlciBkb2VzIGl0J3Mgam9iLlxuICAgKiBOb3Qgc3BlY2lmaWMgdG8gV2ViUlRDLlxuICAgKi9cbiAgcHJpdmF0ZSBiZWdpblBsYXliYWNrKCkge1xuICAgIHZhciBub2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd2aWRlbycpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIG5vZGVzW2ldLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuXG5cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==